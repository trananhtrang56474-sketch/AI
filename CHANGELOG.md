# Changelog

本项目记录 **AI-Counselor（心理健康咨询系统）** 的全部重要迭代历程，涵盖算法、系统架构、多模态交互与伦理安全设计。

---

## [2026-01-04] 多模态视觉与学术理论重构

### 🔬 理论与算法层（Academic & Algorithms）

- **文献深度对齐（Paper Alignment）**  
  基于上传的 4 篇核心参考文献，系统性重构了 **RAG 知识库结构** 与 **Prompt 生成策略**，确保理论与工程实现的一致性。

- **E-SCBA 框架工程化落地**  
  参考 *Sun et al. (2022)*《面向情感对话生成的句法约束双向异步框架》，  
  在 `cbt_knowledge.json` 中实现：
  - 情感约束（Emotion Constraint）
  - 主题约束（Topic Constraint）  
  构建“情感 × 逻辑”双重控制的生成机制。

- **CBT 标准化干预范式引入**  
  参考 *黄杏等 (2022)*《基于认知行为疗法的聊天机器人对抑郁情绪的干预作用》，  
  内置 **7 周 CBT 干预课程体系**，涵盖：
  - 情绪命名
  - 认知重构
  - 行为激活
  - 复盘与巩固

- **多模态情感计算升级**  
  结合 *辜雅婷等 (2023)*、*赵妍妍等 (2024)* 的综述研究，  
  增强对高危信号的识别能力，包括：
  - “图文不符”
  - “微笑抑郁”
  - 隐性消极情绪表达

---

### 👁️ 视觉交互能力（Computer Vision）

**模型引擎升级**
- 后端集成 **Qwen-VL-Max** 视觉大模型
- 实现 **Text / Vision 双模型智能切换机制**：
  - 图片输入 → 自动启用视觉模型
  - 纯文本对话 → 使用 `qwen-plus`
- 修复本地路径解析问题，支持将上传图片转为 **Base64 流** 直接送入模型

**图文组合交互**
- 支持“看图说话”模式  
  用户可同时发送：
  - 图片
  - 文字描述  
  模型基于 **视觉 + 语义联合理解** 进行回复

---

### 📸 前端功能（Frontend）

**多模态输入组件**
- `MessageInput.vue` 新增：
  - 📷 相机按钮
  - 图片预览栏
- 实现 **组合发送逻辑**：
  - 前端先上传图片获取 URL
  - 将 `{ text, image_url }` 一并发送至后端

**视觉渲染优化**
- `ChatWindow.vue` 渲染逻辑升级：
  - 支持 `blob:` 本地预览流
  - 支持后端 `/uploads/` 静态资源
- 新增 **全屏图片预览（Lightbox）** 功能

---

### ⚙️ 后端架构（Backend）

**静态资源服务**
- 新增 `/api/upload` 接口：
  - 文件存储
  - 时间戳重命名
  - 可访问 URL 生成
- 开放 `/uploads/<filename>` 静态资源路由

**接口协议升级**
- `/api/chat` 接口支持：
  - `message`
  - `image_url`
- 优化 `ChatLog` 存储策略：
  - 图片消息与文字消息分条存储
  - 保证多模态历史记录完整性

---

## [2026-01-02] 架构重构与交互优化

### 🎨 前端界面重构

- 移除 `ChatPage` 与 `App` 中重复的侧边栏逻辑
- 统一使用全局 `Sidebar` 组件
- 侧边栏支持：
  - 历史记录列表
  - 折叠 / 展开（汉堡菜单）
  - 响应式联动布局
- `ChatPage` 简化为纯内容渲染组件

---

### ⚡ 逻辑功能增强

- **路由驱动会话加载**  
  支持通过 `?session_id=xxx` 加载历史对话

- **跨组件通信优化**  
  引入 `eventBus.js`，实现：
  - 新建对话 → 左侧列表自动刷新

- **交互流程优化**
  - 新建对话自动清空聊天窗口
  - 路由状态同步重置

---

### 🗑️ 代码清理

- 删除废弃组件 `HistoryList.vue`
- 精简 `App.vue` 与 `ChatPage.vue` 冗余逻辑

---

## [2025-12-25] MVP 版本发布

### 🎉 核心功能上线

**基础架构**
- Flask（Backend） + Vue 3（Frontend）前后端分离

**大模型接入**
- 成功接入 **阿里云通义千问（qwen-plus）** API

**数据持久化**
- SQLAlchemy + MySQL
- 三张核心表：
  - `User`
  - `ChatSession`
  - `ChatLog`

**RAG 原型**
- 实现基于关键词匹配的心理学知识检索模块 `rag_engine`

**用户系统**
- 预留 JWT 鉴权机制
- 提供：
  - `/api/register`
  - `/api/login`

---
